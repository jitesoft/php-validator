include:
  - https://gitlab.com/jitesoft/gitlab-ci-lib/raw/master/code_quality.yml
  - https://gitlab.com/jitesoft/gitlab-ci-lib/raw/master/dependency_scanning.yml

stages:
  - build
  - test
  - scan

build:
  stage: build
  image: jitesoft/composer
  script:
    - composer install --prefer-dist --no-progress

test:
  stage: test
  image: jitesoft/composer:latest
  dependencies:
    - build
  script:
    - vendor/bin/phpunit tests/ --coverage-text --colors=never --whitelist=src/
    - vendor/bin/phpcs -p ./src --report=summary --standard=./style.xml

scan:dep:
  extends: .scan:composer

scan:code:
  extends: .code_quality
